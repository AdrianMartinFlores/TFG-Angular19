<app-nav></app-nav>
<div class="contenedor-tareas">
  <h1 class="titulo-tareas">Tareas</h1>
  <form (submit)="guardarTarea($event)" class="formulario-tarea">
    <label for="titulo-tarea">TÃ­tulo</label>
    <input id="titulo-tarea" [(ngModel)]="tareaSeleccionada.titulo" name="titulo" class="input-tarea" required
      placeholder="TÃ­tulo" />

    <label for="descripcion-tarea">DescripciÃ³n</label>
    <input id="descripcion-tarea" [(ngModel)]="tareaSeleccionada.descripcion" name="descripcion" class="input-tarea"
      placeholder="DescripciÃ³n" />

    <label for="grupo-tarea">Grupo</label>
    <select id="grupo-tarea" [(ngModel)]="tareaSeleccionada.grupo_id" name="grupo_id" class="input-tarea">
      <option [ngValue]="null">Sin grupo</option>
      <option *ngFor="let grupo of grupos" [ngValue]="grupo.id">{{ grupo.nombre }}</option>
    </select>

    <label for="color-tarea">Color</label>
    <input id="color-tarea" type="color" [(ngModel)]="tareaSeleccionada.color" name="color" class="input-color"
      [value]="tareaSeleccionada.color || '#fafdff'" />

    <button type="submit" class="boton-tarea boton-azul">
      {{ tareaSeleccionada.id ? 'Actualizar' : 'Crear' }}
    </button>
    <span *ngIf="mensaje" class="mensaje-error">{{ mensaje }}</span>
  </form>

  <div class="filtros-tareas">
    <select [(ngModel)]="grupoSeleccionado" (change)="cargarTareasPorGrupo()" class="input-tarea"
      style="max-width:110px;">
      <option [ngValue]="null">Todos</option>
      <option *ngFor="let grupo of grupos" [ngValue]="grupo.id">{{ grupo.nombre }}</option>
    </select>
    <button class="boton-tarea boton-verde" (click)="mostrarCrearGrupo = !mostrarCrearGrupo">Crear nuevo grupo</button>
  </div>

  <div *ngIf="mostrarCrearGrupo" class="crear-grupo">
    <input [(ngModel)]="nuevoGrupoNombre" placeholder="Nombre grupo" class="input-tarea" />
    <button class="boton-tarea boton-azul" (click)="crearGrupo()">Crear</button>
    <button class="boton-tarea boton-gris" (click)="mostrarCrearGrupo = false">X</button>
  </div>

  <h2 class="separador">Grupos creados</h2>
  <ul class="lista-grupos">
    <li *ngFor="let grupo of grupos" class="grupo">
      <span *ngIf="grupoEditandoId !== grupo.id" class="nombre-grupo">{{ grupo.nombre }}</span>
      <input *ngIf="grupoEditandoId === grupo.id" [(ngModel)]="nuevoNombreGrupoEditando"
        class="input-tarea input-grupo-edit" />
      <div class="acciones-grupo">
        <button *ngIf="grupoEditandoId !== grupo.id" (click)="editarGrupo(grupo)" class="boton-tarea boton-azul"
          title="Editar">âœŽ</button>
        <button *ngIf="grupoEditandoId === grupo.id" (click)="guardarEdicionGrupo(grupo)"
          class="boton-tarea boton-verde" title="Guardar">âœ”</button>
        <button *ngIf="grupoEditandoId === grupo.id" (click)="cancelarEdicionGrupo()" class="boton-tarea boton-gris"
          title="Cancelar">âœ–</button>
        <button (click)="eliminarGrupo(grupo.id)" class="boton-tarea boton-rojo" title="Eliminar">ðŸ—‘</button>
      </div>
    </li>
  </ul>

  <h2 class="separador">Tareas sin marcar</h2>
  <ul class="lista-tareas">
    <li class="tarea" *ngFor="let tarea of tareasPendientes" [ngStyle]="{'background-color': tarea.color || '#fafdff'}">
      <span class="titulo-tarea">{{ tarea.titulo }}</span>
      <span *ngIf="tarea.grupo_id" class="grupo-tarea">{{ getNombreGrupo(tarea.grupo_id) }}</span>
      <div class="acciones-tarea">
        <button (click)="completarTarea(tarea)" class="boton-tarea boton-verde">âœ”</button>
        <button (click)="editarTarea(tarea)" class="boton-tarea boton-azul">âœŽ</button>
        <button (click)="eliminarTarea(tarea.id)" class="boton-tarea boton-rojo">ðŸ—‘</button>
      </div>
    </li>
  </ul>

  <h2 class="separador">Tareas realizadas</h2>
  <ul class="lista-completadas">
    <li *ngFor="let tarea of tareasCompletadas" class="completada"
      [ngStyle]="{'background-color': tarea.color || '#fafdff'}">
      <span class="titulo-tarea">{{ tarea.titulo }}</span>
      <span *ngIf="tarea.grupo_id" class="grupo-tarea">{{ getNombreGrupo(tarea.grupo_id) }}</span>
      <button (click)="marcarComoNoTerminada(tarea)" class="boton-tarea boton-amarillo">â†º</button>
      <button (click)="eliminarTarea(tarea.id)" class="boton-tarea boton-rojo">ðŸ—‘</button>
    </li>
  </ul>
</div>